<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>NFCReader</title>
        <!--link rel="stylesheet" href="style.css"-->
        <!--script src="script.js"></script-->
    </head>
    <body>
        <!-- page content -->
        <h1>NFC Reader</h1>
        <div>
            <p>To read the M24LR04E-R RFID tag.</p>
            <button id="scanButton">Query NFC</button>
            <p id="log">Logger...</p>
        </div>
    </body>
    <script>
        const ndef = new NDEFReader();

        async function startScanning() {
            await ndef.scan();
            ndef.onreading = event => {
                const message = event.message;
                console.log("Received message !");
                document.getElementById("log").innerHTML = "Record type:  " + record.recordType;
                for (const record of message.records) {
                    console.log("Record type:  " + record.recordType);
                    console.log("MIME type:    " + record.mediaType);
                    console.log("Record id:    " + record.id);
                    switch (record.recordType) {
                        case "text":
                        // TODO: Read text record with record data, lang, and encoding.
                        break;
                        case "url":
                        // TODO: Read URL record with record data.
                        break;
                        default:
                        // TODO: Handle other records with record data.
                    }
                }
            };
        }

        const nfcPermissionStatus = await navigator.permissions.query({ name: "nfc" });
        if (nfcPermissionStatus.state === "granted") {
            // NFC access was previously granted, so we can start NFC scanning now.
            startScanning();
        } else {
            // Show a "scan" button.
            document.querySelector("#scanButton").style.display = "block";
            document.querySelector("#scanButton").onclick = event => {
                // Prompt user to allow UA to send and receive info when they tap NFC devices.
                startScanning();
            };
        }
    </script>
</html> 
